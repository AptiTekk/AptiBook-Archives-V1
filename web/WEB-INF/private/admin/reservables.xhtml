<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:pf="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">

<ui:composition>
    <h:panelGroup layout="block" id="reservablesPage">
        <b:container>
            <b:row>

                <!-- Reservable Type Selection List -->
                <b:column colXs="12" colSm="3">
                    <h:form>
                        <div class="form-group">
                            <pf:dataTable id="reservableTypeDT" value="#{ReservablesEditController.reservableTypes}"
                                          var="reservableType"
                                          selectionMode="single"
                                          selection="#{ReservablesEditController.selectedReservableType}"
                                          rowKey="#{reservableType.id}" sortBy="#{reservableType.name}">
                                <pf:ajax event="rowSelect" update=":reservablesPage" onstart="loading_start()"
                                         oncomplete="loading_complete()"/>
                                <pf:ajax event="rowUnselect" update=":reservablesPage" onstart="loading_start()"
                                         oncomplete="loading_complete()"/>
                                <pf:column headerText="Reservable Type" priority="1" style="width:100%">
                                    <h:outputText value="#{reservableType.name}"/>
                                </pf:column>
                            </pf:dataTable>
                        </div>
                        <div class="form-group">
                            <h:commandButton action="#{ReservablesEditController.addNewReservableType}"
                                             styleClass="btn btn-success" value="Add New Reservable Type">
                                <f:ajax render=":reservablesPage" onevent="loading"/>
                            </h:commandButton>
                        </div>
                    </h:form>
                </b:column>

                <!-- Reservable Type Edit Fields -->
                <b:column colXs="12" colSm="9">
                    <h:form styleClass="form-horizontal" id="reservableTypeEditForm">

                        <div class="form-group">
                            <b:column colXs="9" offsetXs="3">
                                <b:messages for=":reservableTypeEditForm" showSummary="false"
                                            showDetail="true"/>
                                <h4>Reservable Type Settings:</h4>
                            </b:column>
                        </div>
                        <div class="form-group">
                            <h:outputLabel value="Name:" styleClass="col-xs-3 control-label"/>
                            <b:column colXs="9">
                                <h:inputText styleClass="form-control"
                                             value="#{ReservablesEditController.editableReservableTypeName}"
                                             disabled="#{ReservablesEditController.selectedReservableType == null}"/>
                            </b:column>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-offset-3 col-xs-9">
                                <div class="btn-toolbar">
                                    <h:commandButton styleClass="btn btn-primary"
                                                     value="Save Changes" style="display: inline-block"
                                                     action="#{ReservablesEditController.updateSettings()}"
                                                     disabled="#{ReservablesEditController.selectedReservableType == null}">
                                        <f:ajax execute="@form" render=":reservablesPage" onevent="loading"/>
                                    </h:commandButton>
                                    <h:commandButton styleClass="btn btn-default"
                                                     value="Reset Fields" style="display: inline-block"
                                                     action="#{ReservablesEditController.resetSettings()}"
                                                     disabled="#{ReservablesEditController.selectedReservableType == null}">
                                        <f:ajax execute="@form" render=":reservablesPage" onevent="loading"/>
                                    </h:commandButton>
                                    <b:button styleClass="btn btn-danger"
                                              value="Delete Reservable Type"
                                              style="display: inline-block"
                                              p:data-toggle="modal"
                                              p:data-target="#reservableTypeDeletionConfirmModal"
                                              disabled="#{ReservablesEditController.selectedReservableType == null}"/>
                                </div>
                            </div>
                        </div>
                    </h:form>

                    <!-- Reservables Accordion -->
                    <div class="form-horizontal">
                        <div class="form-group">
                            <b:column colXs="9" offsetXs="3">
                                <h4>Reservables:</h4>
                            </b:column>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-offset-3 col-xs-9">
                                <p style="font-weight: 600">Expand rows to edit Reservables</p>
                                <c:choose>

                                    <!-- No Reservables Found -->
                                    <c:when test="#{empty ReservablesEditController.selectedReservableType.reservables}">
                                        <p>This Reservable Type has no Reservables! Click the button below to get started.</p>
                                    </c:when>

                                    <!-- Reservables Found -->
                                    <c:otherwise>
                                        <pf:accordionPanel dynamic="true" cache="true" activeIndex="-1"
                                                           value="#{ReservablesEditController.selectedReservableType.reservables}"
                                                           var="reservable">
                                            <pf:ajax event="tabChange"
                                                     listener="#{ReservablesEditController.onReservableTabChange}"
                                                     update=":reservableDeletionConfirmModal" onstart="loading_start()"
                                                     oncomplete="loading_complete()"/>

                                            <pf:tab title="#{reservable.name}">
                                                <h:form id="reservableEditForm">
                                                    <!-- Edit Fields -->
                                                    <div class="form-group">
                                                        <h:outputLabel value="Name:"
                                                                       styleClass="col-xs-3 control-label"/>
                                                        <b:column colXs="9">
                                                            <h:inputText id="name" styleClass="form-control"
                                                                         value="#{ReservablesEditController.editableTabReservableName}">
                                                                <f:ajax render="@form"/>
                                                            </h:inputText>
                                                            <pf:tooltip for="name"
                                                                        value="The name as will be shown to users making reservations. E.g.: 'Library'"/>
                                                        </b:column>
                                                    </div>

                                                    <div class="form-group">
                                                        <h:outputLabel value="Requires Approval:"
                                                                       styleClass="col-xs-3 control-label"/>
                                                        <b:column colXs="9">
                                                            <h:selectBooleanCheckbox id="approvalCheck"
                                                                                     value="#{ReservablesEditController.editableTabReservableApproval}">
                                                                <f:ajax render="@form"/>
                                                            </h:selectBooleanCheckbox>
                                                            <pf:tooltip for="approvalCheck"
                                                                        value="If checked, any requested reservations for this Reservable must be approved by the groups which own it."/>
                                                        </b:column>
                                                    </div>

                                                    <div class="form-group">
                                                        <h:outputLabel value="Min. Allowed Time:"
                                                                       styleClass="col-xs-3 control-label"/>
                                                        <b:column colXs="9">
                                                            <h:selectOneMenu id="minTime"
                                                                             value="#{ReservablesEditController.editableTabReservableAvailabilityStart}"
                                                                             styleClass="big-select">
                                                                <f:selectItem itemValue="#{null}"
                                                                              itemLabel="--- Select a Time ---"
                                                                              noSelectionOption="true"/>
                                                                <f:selectItems
                                                                        value="#{TimeSelectionController.startTimes}"
                                                                        var="time"/>
                                                                <f:ajax render="@form"
                                                                        onevent="loading"/>
                                                            </h:selectOneMenu>
                                                            <pf:tooltip for="minTime"
                                                                        value="No reservations may be made before this time."/>
                                                        </b:column>
                                                    </div>

                                                    <div class="form-group">
                                                        <h:outputLabel value="Max. Allowed Time:"
                                                                       styleClass="col-xs-3 control-label"/>
                                                        <b:column colXs="9">
                                                            <h:selectOneMenu id="maxTime"
                                                                             value="#{ReservablesEditController.editableTabReservableAvailabilityEnd}"
                                                                             styleClass="big-select"
                                                                             disabled="#{ReservablesEditController.editableTabReservableAvailabilityStart == null}">
                                                                <f:selectItems
                                                                        value="#{TimeSelectionController.getEndTimes(ReservablesEditController.editableTabReservableAvailabilityStart)}"
                                                                        var="time"/>
                                                                <f:ajax render="@form"
                                                                        onevent="loading"/>
                                                            </h:selectOneMenu>
                                                            <pf:tooltip for="maxTime"
                                                                        value="No reservations may be made after this time."/>
                                                        </b:column>
                                                    </div>

                                                    <div class="form-group">
                                                        <h:outputLabel value="Owner Group:"
                                                                       styleClass="col-xs-3 control-label"/>
                                                        <b:column colXs="9">
                                                            <pf:tree id="tree"
                                                                     value="#{GroupTreeController.getTree(ReservablesEditController.tabReservableCurrentOwnerGroup, null, false)}"
                                                                     var="node" dynamic="true"
                                                                     orientation="horizontal" selectionMode="single">
                                                                <pf:ajax event="select" onstart="loading_start()"
                                                                         oncomplete="loading_complete()"
                                                                         listener="#{ReservablesEditController.onOwnerSelected}"/>
                                                                <pf:treeNode>
                                                                    <h:outputText value="#{node.name}"/>
                                                                </pf:treeNode>
                                                            </pf:tree>
                                                            <pf:tooltip for="tree"
                                                                        value="The selected group and its parents will be notified of reservation requests for this Reservable."
                                                                        showDelay="1000"/>
                                                        </b:column>
                                                    </div>

                                                    <!-- Save, Reset, Delete buttons -->
                                                    <div class="form-group">
                                                        <div class="col-xs-offset-3 col-xs-9">
                                                            <div class="btn-toolbar">
                                                                <h:commandButton styleClass="btn btn-primary"
                                                                                 value="Save Changes"
                                                                                 style="display: inline-block"
                                                                                 action="#{ReservablesEditController.updateTabReservableSettings()}">
                                                                    <f:ajax execute="@form"
                                                                            render=":reservablesPage"
                                                                            onevent="loading"/>
                                                                </h:commandButton>
                                                                <h:commandButton styleClass="btn btn-default"
                                                                                 value="Reset Fields"
                                                                                 style="display: inline-block"
                                                                                 action="#{ReservablesEditController.resetTabReservableSettings()}">
                                                                    <f:ajax render="@form"
                                                                            onevent="loading"/>
                                                                </h:commandButton>
                                                                <b:button styleClass="btn btn-danger"
                                                                          value="Delete Reservable"
                                                                          style="display: inline-block"
                                                                          p:data-toggle="modal"
                                                                          p:data-target="#reservableDeletionConfirmModal"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </h:form>
                                            </pf:tab>
                                        </pf:accordionPanel>
                                    </c:otherwise>
                                </c:choose>
                            </div>
                        </div>

                        <!-- Add new Reservable Button -->
                        <div class="form-group">
                            <div class="col-xs-offset-3 col-xs-9">
                                <div class="btn-toolbar">
                                    <h:form>
                                        <h:commandButton styleClass="btn btn-success"
                                                         value="Add New Reservable" style="display: inline-block"
                                                         action="#{ReservablesEditController.addNewReservable()}"
                                                         disabled="#{ReservablesEditController.selectedReservableType == null}">
                                            <f:ajax render=":reservablesPage" onevent="loading"/>
                                        </h:commandButton>
                                    </h:form>
                                </div>
                            </div>
                        </div>
                    </div>
                </b:column>
            </b:row>

            <!-- Reservable Type Deletion Confirmation Modal -->
            <b:modal id="reservableTypeDeletionConfirmModal" title="Reservable Type
                         Deletion Confirmation">
                Are you sure you want to delete the Reservable Type '#{ReservablesEditController.selectedReservableType.name}'?
                <br/>
                <p style="text-decoration: underline">All associated reservables will be deleted as well!</p>
                <f:facet name="footer">
                    <b:button styleClass="btn btn-default"
                              p:data-dismiss="modal" value="Cancel"/>
                    <h:commandButton styleClass="btn btn-danger"
                                     p:data-dismiss="modal" value="Delete"
                                     action="#{ReservablesEditController.deleteSelectedReservableType}">
                        <f:ajax render=":reservablesPage" onevent="loading"/>
                    </h:commandButton>
                </f:facet>
            </b:modal>

            <!-- Reservable Deletion Confirmation Modal -->
            <b:modal id="reservableDeletionConfirmModal" title="Reservable
                         Deletion Confirmation">
                Are you sure you want to delete the Reservable '#{ReservablesEditController.selectedTabReservable.name}'?
                <br/>
                <p style="text-decoration: underline">All associated reservations for this Reservable will be deleted as well!</p>
                <f:facet name="footer">
                    <b:button styleClass="btn btn-default"
                              p:data-dismiss="modal" value="Cancel"/>
                    <h:commandButton styleClass="btn btn-danger"
                                     p:data-dismiss="modal" value="Delete"
                                     action="#{ReservablesEditController.deleteSelectedTabReservable}">
                        <f:ajax render=":reservablesPage" onevent="loading"/>
                    </h:commandButton>
                </f:facet>
            </b:modal>
        </b:container>
    </h:panelGroup>
</ui:composition>

</html>