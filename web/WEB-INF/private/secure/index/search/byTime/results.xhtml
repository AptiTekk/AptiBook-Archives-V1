<!--
  ~ Copyright (C) 2016 AptiTekk, LLC. (https://AptiTekk.com/) - All Rights Reserved
  ~ Unauthorized copying of any part of AptiBook, via any medium, is strictly prohibited.
  ~ Proprietary and confidential.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
>
<ui:composition>
    <b:container>
        <b:row>
            <b:column colXs="12">
                <ol class="breadcrumb" style="margin-top: 20px">
                    <li><h:link outcome="index" value="Home"/></li>
                    <li class="active">Search By Time</li>
                </ol>
            </b:column>
        </b:row>

        <b:row>
            <b:column colXs="12">
                <h:form id="results-time-selection" styleClass="form-inline">
                    <div class="form-group">
                        Available
                        <h:selectOneMenu value="#{searchByTimeController.assetCategory}"
                                         styleClass="form-control"
                                         converter="#{assetCategoryConverter}">
                            <f:selectItems value="#{searchByTimeController.assetCategories}"
                                           var="assetCategory" itemLabel="#{assetCategory.name}"
                                           itemValue="#{assetCategory}"/>
                            <f:ajax render="@form"/>
                        </h:selectOneMenu>
                    </div>
                    <div class="form-group">
                        from
                        <b:dateTimePicker format="MM/DD/YYYY h:mm a"
                                          value="#{searchByTimeController.pickerStartTime}" ajax="true"
                                          update="endTimePicker" process="@this" sideBySide="true"
                                          ondtchange="ajax:true"/>
                    </div>
                    <div class="form-group">
                        to
                        <b:dateTimePicker id="endTimePicker" format="MM/DD/YYYY h:mm a"
                                          minDate="#{searchByTimeController.pickerStartTime}"
                                          value="#{searchByTimeController.pickerEndTime}"
                                          disabled="#{searchByTimeController.pickerStartTime == null}"
                                          ajax="true"
                                          update="searchButton" process="@this" sideBySide="true"
                                          ondtchange="ajax:true"/>
                    </div>
                    <div class="form-group">
                        <b:commandButton id="searchButton" look="primary" value="Search Again"
                                         action="#{availableAssetsController.searchForAssets(searchByTimeController.assetCategory, searchByTimeController.startTime, searchByTimeController.endTime)}"
                                         ajax="true" update=":includeGroup"/>
                    </div>
                </h:form>
            </b:column>
        </b:row>
        <hr/>
        <b:row style="margin-top:10px">
            <b:column colXs="12" colMd="4" rendered="#{not empty availableAssetsController.filterTags}">
                <h:form>
                    <b:panel look="default" title="Filters">
                        <c:forEach items="#{availableAssetsController.filterTags}" var="tag" varStatus="status">
                            <b:switch value="#{availableAssetsController.selectedFilterTags[status.index]}"
                                      label="#{tag.name}"
                                      ajax="true" update=":availableAssetsList"
                                      onchange="ajax:availableAssetsController.filterAssets()"/>
                        </c:forEach>
                    </b:panel>
                </h:form>
            </b:column>
            <b:column colXs="12" colMd="8">
                <h:form id="availableAssetsList">
                    <c:choose>
                        <c:when test="#{empty availableAssetsController.filteredAssets}">
                            <h2>No Available #{searchByTimeController.assetCategory.name} Found!</h2>
                        </c:when>
                        <c:otherwise>

                            <ui:repeat value="#{availableAssetsController.filteredAssets}" var="asset">
                                <b:panel look="info" collapsible="false" title="#{asset.name}">
                                    <h:panelGroup layout="block" class="form-group" rendered="#{asset.image != null}">
                                        <p:lightBox>
                                            <h:outputLink value="#{request.contextPath}/images/assets/#{asset.id}">
                                                <h:graphicImage url="/images/assets/#{asset.id}"
                                                                style="height: 100px; border-radius: 5px"/>
                                            </h:outputLink>
                                        </p:lightBox>
                                    </h:panelGroup>
                                    <div class="form-group">
                                        <h:commandButton styleClass="btn btn-default" value="Make Reservation"
                                                         action="#{availableAssetsController.onMakeReservationFired(asset, searchByTimeController.startTime, searchByTimeController.endTime)}">
                                            <f:ajax render=":includeGroup"/>
                                        </h:commandButton>
                                    </div>
                                </b:panel>
                            </ui:repeat>

                        </c:otherwise>
                    </c:choose>
                </h:form>
            </b:column>
        </b:row>
    </b:container>
</ui:composition>
</html>