<!--
  ~ Copyright (C) 2016 AptiTekk, LLC. (https://AptiTekk.com/) - All Rights Reserved
  ~ Unauthorized copying of any part of Agenda, via any medium, is strictly prohibited.
  ~ Proprietary and confidential.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
>
<ui:composition>
    <b:container>
        <b:row>
            <b:column colXs="12">
                <h:form id="results-time-selection" styleClass="form-inline" style="margin-top:30px">
                    <div class="form-group">
                        Available
                        <h:selectOneMenu value="#{timeSelectionController.selectedAssetCategory}" styleClass="form-control"
                                         converter="#{assetCategoryConverter}">
                            <f:selectItems value="#{timeSelectionController.assetCategories}"
                                           var="assetCategory" itemLabel="#{assetCategory.name}" itemValue="#{assetCategory}"/>
                            <f:ajax render="@form"/>
                        </h:selectOneMenu>
                    </div>
                    <div class="form-group">
                        on
                        <p:calendar mode="popup" value="#{timeSelectionController.selectedDate}"
                                    mindate="#{timeSelectionController.minDate}"
                                    pattern="#{timeSelectionController.friendlyDatePattern}"
                                    styleClass="inline-calendar-form-control">
                            <f:ajax event="dateSelect" render="@form"/>
                        </p:calendar>
                    </div>
                    <div class="form-group">
                        from
                        <h:selectOneMenu value="#{timeSelectionController.selectedStartTime}"
                                         styleClass="form-control" converter="#{SegmentedTimeConverter}"
                                         disabled="#{timeSelectionController.selectedAssetCategory == null}">
                            <f:selectItems
                                    value="#{timeSelectionController.getStartTimes(timeSelectionController.todaySelected)}"
                                    var="time" itemValue="#{time}" itemLabel="#{time.timeString}"/>
                            <f:ajax render="@form"/>
                        </h:selectOneMenu>
                    </div>
                    <div class="form-group">
                        to
                        <h:selectOneMenu value="#{timeSelectionController.selectedEndTime}"
                                         styleClass="form-control" converter="#{SegmentedTimeConverter}"
                                         disabled="#{timeSelectionController.selectedStartTime == null}">
                            <f:selectItems
                                    value="#{timeSelectionController.endTimes}"
                                    var="time" itemValue="#{time}" itemLabel="#{time.timeString}"/>
                            <f:ajax render="@form"/>
                        </h:selectOneMenu>
                    </div>
                    <div class="form-group">
                        <h:commandButton styleClass="btn btn-primary" value="Update Time"
                                         action="#{availableAssetsController.searchForAssets(timeSelectionController.selectedAssetCategory, timeSelectionController.segmentedTimeRange)}">
                            <f:ajax render=":includeGroup" execute="@form" onevent="loading"/>
                        </h:commandButton>
                    </div>
                </h:form>
            </b:column>
        </b:row>
        <b:row style="margin-top:10px">
            <b:column colXs="12" colMd="4">
                <h:form>
                    <b:panel look="default" title="Filters">
                        <h:selectManyCheckbox value="#{availableAssetsController.selectedFilterTags}"
                                              converter="#{TagConverter}" layout="pageDirection">
                            <f:ajax render=":availableAssetsList"/>
                            <f:selectItems value="#{availableAssetsController.filterTags}" var="tag" itemValue="#{tag}"
                                           itemLabel="#{tag.name}"/>
                        </h:selectManyCheckbox>
                    </b:panel>
                </h:form>
            </b:column>
            <b:column colXs="12" colMd="8">
                <h:form id="availableAssetsList">
                    <c:choose>
                        <c:when test="#{empty availableAssetsController.filteredAssets}">
                            <h2>No Available #{timeSelectionController.selectedAssetCategory.name} Found!</h2>
                            <h4>Try adjusting your reservation time or filters.</h4>
                        </c:when>
                        <c:otherwise>

                            <ui:repeat value="#{availableAssetsController.filteredAssets}" var="asset">
                                <b:panel look="info" collapsible="false" title="#{asset.name}">
                                    <h:panelGroup layout="block" class="form-group" rendered="#{asset.image != null}">
                                        <p:lightBox>
                                            <h:outputLink value="#{request.contextPath}/images/assets/#{asset.id}">
                                                <h:graphicImage url="/images/assets/#{asset.id}"
                                                                style="height: 100px; border-radius: 5px"/>
                                            </h:outputLink>
                                        </p:lightBox>
                                    </h:panelGroup>
                                    <div class="form-group">
                                        <h:commandButton styleClass="btn btn-default" value="Make Reservation"
                                                         action="#{availableAssetsController.onMakeReservationFired(authenticationController.authenticatedUser, asset, timeSelectionController.segmentedTimeRange)}"/>
                                    </div>
                                </b:panel>
                            </ui:repeat>

                        </c:otherwise>
                    </c:choose>
                </h:form>
            </b:column>
        </b:row>
    </b:container>
</ui:composition>
</html>